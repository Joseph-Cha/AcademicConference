# 예측 가능한 코드를 작성하라

## 키워드

- 코드가 어떻게 예측을 벗어나는지
- 그 것을 어떻게 방지하는지
- null, optional, error

## 1. 매직 값을 반환하지 말라

매직 값으로 연산을 하는 경우 문제가 발생할 수 있다.

- 생각
    1. 실제로 그럴 일이 발생할 수 없다.
    2. 반환 값의 유효성을 검사한다.
    
    위와 같은 상황이면 사용해도 괜찮을 것이라 생각하지만 지금은 다른 대안이 있으니 반환하지 않으면 될 것 같다. 1번에서 내 생각이 틀렸을 수도 있다(물론, indexOf와 같이 절대 그럴 일은 없을 수 도 있지만..) 또, 99.9%의 다른 개발자가 반환 값을 그대로 사용할 것이다. 
    

때때로 매직 값이 우연히 발생할 수 있다. 

## 2. 널 객체 패턴을 적절히 사용하라

간단하게는 빈 문자열, 빈 컬렉션을 반환하는 것에서부터 복잡하게는 모든 메서드가 아무것도 하지 않거나 기본값을 반환하는 클래스를 구현하는 것

널 객체 패턴과 관련하여 좋은 [블로그 글]([https://johngrib.github.io/wiki/pattern/null-object/](https://johngrib.github.io/wiki/pattern/null-object/))을 발견

문자열이 **단지** 문자를 모아 놓은 것에 불과하고 코드에서 별다른 의미가 없는 경우가 아니라면 널 객체 패턴 사용 금지

복잡한 널 객체는 예측을 벗어날 수 있다.

- 생각
    
    그냥 안전하게 간단한 널 객체 패턴(빈 문자열 또는 빈 컬렉션 반환)을 사용하자
    

## 3. 예상치 못한 부수 효과를 피하라

부수 효과 유형

- 사용자에게 출력 표시
- 파일이나 데이터베이스에 무언가를 저장
- 다른 시스템을 호출하여 네트워크 트래픽 발생
- 캐시 업데이트 혹은 무효화

분명하고 의도적인 부수 효과는 괜찮다. 그렇다면 예기치 않은 부수 효과는 무슨 문제를 발생시킬 수 있을까?

- 비용이 많이 들 수 있다.
- 호출한 쪽의 가정을 깨뜨려 예기치 못한 결과를 초래한다.
- 다중 스레드 환경에서 예상치 못한 결과를 초래한다.

이에 대한 해결책으로는 부수 효과를 피하거나 그 사실을 분명하게 하는 것이다. (5장의 서술적 명칭사용과 연결되는 것 같다.)

## 4. 입력 매개변수를 수정하는 것에 주의하라

입력 매개변수를 수정하는 것은 함수 외부에 영향을 끼칠 수 있으므로 변경이 필요하다면 복사 후 변경한다. 하지만 매우 많은 양의 데이터를 처리하거나, 저가 하드웨어에서 실행될 가능성이 있는 경우는 이를 피하기가 어렵다. 가령 리스트를 정렬해야 하는 경우 리스트의 크기가 매우 크다면 복사 후 정렬보다는 그냥 정렬을 해야 할 수밖에 없을 수 도 있을 것이다. 하지만 역시 3번과 마찬가지로 그 사실을 명확하게 하여 호출자가 이를 알 수 있도록 한다.

## 5. 오해를 일으키는 함수는 작성하지 말라

## 6. 미래를 대비한 열거형 처리

: default 또는 else 부분에 에러를 내뱉자.

다른 프로젝트의 열거형에 의존하지 말자.

## 7. 테스트로 처리할 수 없는가?

테스트는 중요하지만 완벽하지는 않다

# 생각

- 널 객체 패턴에서 아무것도 하지 않는 클래스를 만드는 것은 처음 보았다. 여태까지는 빈 컬렉션을 반환하는 정도로만 사용했는데 이게 널 객체 패턴이라는 이름으로 불린다는 것도 처음 알았다. 열심히 공부하자
- 그 외 부분에 대해서는 당연한 것들이지만 평소에는 신경 쓰지 않는 것들이 몇 가지가 있어 좀 더 체화시켜야겠다고 느낌

# 질문

- 테스트 더블을 설명할 때 흔히 ‘자기 친구를 앉혀놓고 면접 연습’하는 것과 같다고 합니다. 하지만 그건 어디까지나 예상 질문과 답을 갖고 연습하는 거지 실제 면접이 아니라는 생각이 있습니다. 만약 예상 질문이 하나도 나오지 않았다면 단순히 시간 낭비를 한 셈이 아닌가 하는 생각이 들어 매번 테스트를 작성하면서도 이게 맞는 것인가 하는 생각이 들곤 합니다. 물론, 테스트가 매우 중요하다는 것은 이견이 없지만, 여러분들의 생각이 궁금합니다.