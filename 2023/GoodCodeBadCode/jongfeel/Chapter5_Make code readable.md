## 5장 가독성 높은 코드를 작성하라

가독성은 본질적으로 주관적인 것이며 그것이 정확히 무엇을 의미하는지 확실하게 정의하기는 어렵다.
가독성의 핵심은 개발자가 코드의 기능을 빠르고 정확하게 이해할 수 있도록 하는 것이다.

<pre>
논의내용)
<b>가독성 높은 코드를 작성하기 위해 내가 실천하고 있는 방법 하나 쯤 논의</b>해 보기
책에 나와 있는 예제 9개도 좋고, 그 외의 방법을 얘기해도 좋다.

나의 경우는 최대한 서술형으로 쓰려고 노력하고, 이후 코드 검토를 통해 한번 더 읽기 쉬운 매끄러운 문장으로 만들려고 고치는 것도 한다.
여러 책을 읽다 보니 주석을 쓰는 것 보다 코드를 명확하게 쓰는 게 좋다는 걸 알게 된 후로
조금은 의식적으로 주석이 없이도 읽을 수 있는 코드를 작성하는데 많은 노력을 하는 편이다.
</pre>

### 5.1 서술형 명칭 사용 (User descriptive names)

이름은 사물을 고유하게 식별하기 위해 필요하지만 무엇인지에 대해 간단한 설명을 할 때도 많다.
코드에서 이름을 붙이는 것은 그것이 스스로 설명되는 방식으로 언급함으로써 읽기 쉬운 코드 작성을 위한 기회이기도 하다. 

#### 5.1.1 서술적이지 않은 이름은 코드를 읽기 어렵게 만든다.

서술적인 이름을 짓기 위한 어떤 노력도 기울이지 않으면, 코드가 어떻게 보일지 보여주는 극단적인 예 => 무슨 일을 하는지 파악하는 것이 어렵다

class T, Int s, Set<String> pns 등등

#### 5.1.2 주석문으로 서술적인 이름을 대체할 수 없다

이를 개선할 수 있는 한 가지 방법은 주석문과 문서를 추가하는 것이다.
하지만 많은 문제가 있다

- 코드가 훨씬 복잡해 보이고 주석문과 문서도 유지보수해야 한다
- 코드를 이해하기 위해 파일을 계속해서 위아래로 스크롤해야 한다
- 함수 s() 클래스 T와 같은 이름으로 부터 무엇을 하는지 알기 어렵다

#### 5.1.3 해결책: 서술적인 이름 짓기

- 변수, 함수 및 클래스를 별도로 설명할 필요 없이 자명해진다
- team.containsPlayer(playName)과 같은 호출이 무엇을 하는지 무슨 값을 반환하는지 분명하게 알 수 있다.

### 5.2 주석문의 적절한 사용

- 코드가 **무엇**을 하는지 설명
- 코드가 **왜** 그 일을 하는지 설명
- 사용 지침 등 기타 정보 제공

클래스와 같이 큰 단위의 코드가 무엇을 하는지 요약하는 높은 수준에서의 주석문은 유용하다.
그러나 하위 수준에서 한 줄 한 줄 코드가 무엇을 하는지 설명하는 주석문은 가독성을 높이기 위한 효과적인 방법이 아니다.

#### 5.2.1 중복된 주석문은 유해할 수 있다

코드 자체로 무엇을 하는지 설명이 된다면 주석문은 쓸모가 없다.
불필요한 주석문은 단지 쓸무없는 것 이상으로 더 나쁠 수 있다

- 개발자는 주석문을 유지보수해야 한다. 코드 변경 시 주석문 역시 수정해야 한다.
- 코드를 지저분하게 만든다. 100줄의 코드를 읽으려면 100개의 주석문을 읽어야 한다.

#### 5.2.2 주석문으로 가독성 높은 코드를 대체할 수 없다

``` java
String generateId(String[] data) {
  // data[0]는 유저의 이름이고 data[1]은 성이다.
  // "{이름}.{성}"의 형태로 ID를 생성한다.
  return data[0] + "." + data[1];
}
```

코드 자체가 가독성이 높지 않기 때문에 주석문이 필요하지만 더 나은 접근법은 가독성이 좋은 코드를 작성하는 것이다.
이 시나리오에서는 잘 명명된 헬퍼 함수를 사용해서 가독성 높은 코드를 작성할 수 있다.

#### 5.2.3 주석문은 코드의 이유를 설명하는 데 유용하다

코드가 그 일을 **왜** 수행하는지 코드 자체로는 설명하기 어렵다.
아래와 같은 경우에 주석문을 사용해 코드가 존재하는 이유를 설명하면 좋다

- 제품 또는 비즈니스 의사 결정
- 이상하고 명확하지 않은 버그에 대한 해결책
- 의존하는 코드의 예상을 벗어나는 동작에 대처

#### 5.2.4 주석문은 유용한 상위 수준의 요약 정보를 제공할 수 있다

코드 기능에 대한 상위 수준에서의 개략적인 문서는 다음과 같은 경우에 유용하다

- 클래스가 수행하는 작업 및 다른 개발자가 알고 있어야 할 중요한 세부 사항을 개괄적으로 설명하는 문서
- 함수에 대한 입력 매개변수 또는 기능을 설명하는 문서
- 함수의 반환값이 무엇을 나타내는지 설명하는 문서

주석과 문서화는 코드만으로 전달할 수 없는 세부 사항을 설명하거나 코드가 큰 단위에서 하는 일을 요약하는 데 유용하다.
단점으로는 이런 주석문과 문서도 유지 및 보수가 필요하고 내용이 제때 업데이트 되지 않으면 코드와 맞지 않게 되고 코드가 지저분해질 수 있다.

### 5.3 코드 줄 수를 고정하지 말라

코드의 줄 수를 최소화하는 것이 코드 품질에 있어 가장 중요하다고 생각하는 개발자들이 있다.
코드 줄 수는 실제로 신경 쓰는 것들을 간접적으로 측정해줄 뿐이다. 유용한 지침 원칙이긴 하지만 반드시 지켜야 할 엄격한 규칙은 아니라는 점을 기억해야 한다.

정말 신경써야 하는 것은 코드에 대해 다음과 같은 사항들을 확실하게 하는 것이다.

- 이해하기 쉽다
- 오해하기 어렵다
- 실수로 작동이 안 되게 만들기가 어렵다

#### 5.3.1 간결하지만 이해하기 어려운 코드는 피하라

``` java
Boolean isIdValid(UInt16 id) {
    return countSetBits(id & 0x7FFF) % 2 == ((id & 0x8000) >> 15);
```

간결하지만 거의 이해할 수 없다.
여러 개발자는 이 코드가 무엇을 하는지 이해하려고 많은 시간을 낭비할 가능성이 크다.
명확하지 않고 문서화되지 않은 많은 가정으로 인해 코드 수정에 상당히 취약하고, 수정된 코드가 제대로 동작하지 않기가 쉽다.

#### 5.3.2 해결책: 더 많은 줄이 필요하더라도 가독성 높은 코드를 작성하라

코드의 줄 수가 많다는 것은 복잡하게 만들고 있다는 경고 신호가 될 수 있다. 따라서 코드 줄 수를 주시하는 것이 일반적으로는 바람직하다.

그러나 이것보다 더 중요한 것은
코드가 이해하기 쉬워야 하고,
어떤 상황에서도 잘 동작하며,
문제가 되는 동작을 할 가능성은 없는지 확인하는 것이다.

이것을 효과적으로 하기 위해 더 많은 코드가 필요하다면 그것은 문제가 되지 않는다.

### 5.4 일관된 코딩 스타일을 고수하라

더 잘 읽히는 문장을 쓰기 위해 따라야 할 문체에 관한 지침들도 있다.

프로그래밍 언어의 구문과 컴파일러는 문법 규칙처럼 허용되는 것을 규정하지만
개발자가 코드를 작성함에 따라 어떤 스타일로 작성할지는 상당히 자유롭다.

```
의견)
이런 경우에는 주로 그 언어가 사용하는 기본적인 스타일 규칙이 있는데 그것을 따르는 것이 제일 효율적이었던 것 같다.
문법 지키는 것은 당연하지만 스타일을 따르는 건 약간의 자유도가 있고,
각자 어떤 환경에서 개발했는지에 따라서도 미묘한 차이가 있으므로
이것을 팀 차원에서 하우스 룰로 강제하기 보다는 기본 스타일 규칙을 어기지 않는 선만 지키는 걸 하는 게 좋다고 생각한다.
```

#### 5.4.1 일관적이지 않은 코딩 스타일은 혼동을 일으킬 수 있다

일반적으로 클래스 이름은 파스칼 케이스, 변수 이름은 캐멀 케이스로 작성하는데
클래스 이름을 캐멀 케이스로 작성하면 인스턴스 변수와 혼동할 수 있다.

#### 5.4.2 해결책: 스타일 가이드를 채택하고 따르라

코딩 스타일은 명명법 이상의 많은 측면을 다룬다.

- 언어의 특정 기능 사용
- 코드 들여쓰기
- 패키지 및 디렉터리 구조화
- 코드 문서화 방법

구글에는 여러 언어에 대해 구글 스타일 가이드를 제시하고 있다
https://google.github.io/styleguide

팀이나 조직 전체가 같은 코딩 스타일을 따르면, 그것은 마치 모두가 같은 언어를 유창하게 말하는 것과 비슷하다.
서로 오해할 위험이 크게 줄어들고, 이로 인해 버그가 줄어들고, 혼란스러운 코드를 이해하는 데 낭비하는 시간이 줄어든다.

### 5.5 깊이 중첩된 코드를 피하라

일반적으로 코드는 다음과 같이 서로 중첩되는 블록으로 구성된다.

- 함수가 호출되면 그 함수가 실행되는 코드가 하나의 블록이 된다.
- if 문의 조건이 참일 때 실행되는 코드는 하나의 블록이 된다.
- for 루프의 각 반복 시 실행되는 코드는 하나의 블록이 된다.

#### 5.5.1 깊이 중첩된 코드는 읽기 어려울 수 있다

여러 겹으로 중첩된 몇 개의 if 문으로 되어 있는 코드는 상당히 읽기 어렵다.
눈으로 따라가기가 어렵고, 특정 값이 반환되는 시점을 파악하기 위해 if-else 논리를 탐색해야 하기 때문이다.

#### 5.5.2 해결책: 중첩을 최소화하기 위한 구조 변경

if문의 논리를 재구성해서 중첩된 if문을 피한다.
하나의 if문에 하나의 반환문을 작성하면 중첩의 중첩을 피할 수 있고 가독성이 좋아진다.

#### 5.5.3 중첩은 너무 많은 일을 한 결과물이다

코드 예제에서 주소를 찾기 위한 자세한 로직과 편지를 보내는 로직이 하나의 함수에 다 포함되어 있어서 너무 많은 일을 한다.

#### 5.5.4 해결책: 더 작은 함수로 분리

하나의 함수가 너무 많은 일을 하면 추상화 계층이 나빠지므로 많은 일을 하는 함수를 더 작은 함수로 나누는 것은 바람직하다.

### 5.6 함수 호출도 가독성이 있어야 한다

함수의 이름이 잘 지어졌더라도
함수의 인수가 무엇을 위한 것이고, 무슨 역할을 하는지 명확하지 않다면 함수 호출 자체가 이해되지 않을 수 있다.

#### 5.6.1 매개변수는 이해하기 어려울 수 있다

``` java
sendMessage("hello", 1, true);
```

함수 호출 시 각 인수의 값이 무엇을 의미하는지 알려면 함수 정의를 확인해 봐야 한다.
주어진 코드가 무엇을 하는지 알아내기 위해 다른 파일이나 많은 줄을 확인해야 한다면 가독성이 떨어진다.

#### 5.6.2 해결책: 명명된 매개변수 사용

``` java
sendMessage(message: "hello", priority: 1, allowRetry: true);
```

이 방법은 이 기능을 지원하는 프로그래밍 언어에만 해당된다.

타입스크립트의 경우 객체 구조 분해(object destructuring)을 사용할 수 있다.
단일 객체 매개 변수이지만, 이 객체는 매개변수의 속성으로 구조 분해되고 함수 내에서 이 속성을 읽을 수 있다.

그 밖의 언어에서도 명명된 인수와 비슷한 효과를 얻을 수 있는 방법이 있지만,
다른 개발자가 익숙하지 않은 기능을 사용하면 문제를 해결하기보다는 더 많은 문제를 일으킬 수도 있음을 유의해야 한다.

```
의견)
타입스크립트가 아니라 자바스크립트의 특징이기도 하다.
또 명명된 매개변수의 경우 java에서는 없으므로 method chaining 방식의 builder pattern이 발전한 것 같다는 생각도 든다.
C#에서는 꽤 오래전 버전 부터 명명된 매개변수(named parameter)를 지원했었고
object destructuring의 경우도 C#의 tuple로 충분히 대체가 가능하다.
C#은 알게 모르게 상당히 좋은 언어라는 걸 다시 느끼게 된다.
```

#### 5.6.3 해결책: 서술적 유형 사용

정수와 불리언은 상황에 따라 어떤 종류의 값이라도 의미할 수 있기 때문에 그 자체로는 서술적이지 않다.
그래서 특정 유형을 만들어 그 매개변수들이 나타내는 바를 설명하는 것으로 해결이 가능하다.

- 클래스: 메시지의 우선순위를 클래스로 표현한다.
- 열거형: 재시도 정책은 불리언 대신 두 가지 옵션이 있는 열거형을 사용한다.

그러면 아래 코드처럼 사용할 수 있다

``` java
sendMessage("hello", new MessagePriority(1), RetryPolicy.ALLOW_RETRY);
```

#### 5.6.4 때로는 훌륭한 해결책이 없다

인라인 주석문이 생성자의 호출 코드의 가독성을 높일 수 있지만
실수를 하지 않아야 하고, 주석문 역시 최신 상태를 유지해야 하므로 만족스러운 해결책은 아니다.

Setter 함수를 추가하거나 빌더 패턴과 같은 것을 사용하는 것이 대안이 될 수 있지만,
두 방법 모두 값이 누락된 채 인스턴스가 만들어질 수 있기 때문에 코드가 쉽게 오용될 수 있는 단점이 있다.

#### 5.6.5 IDE는 어떤가?

실제 코드

``` java
sendMessage("hello", 1, true);
```

IDE가 보여주는 코드

``` java
sendMessage(message: "hello", priotiry: 1, allowRetry: true);
```

코드를 편집할 때 이 방법이 대단히 유용하지만 코드의 가독성을 위해 이 기능에 의존하지 않는 것이 좋다.

```
의견)
책에 나와있는 IDE는 jetbrain의 IDE이며 코드가 자바 코드이므로 IntelliJ에서 보여주는 방식이다.
모두가 같은 IDE를 사용한다면 좋을 수 있지만, 책에 나와 있는 대로 IDE 도움 없이 코드 자체만 봐야 할 상황이 생기므로 IDE에만 의존하는 프로그래밍은 나중을 위해서라도 좋지 않다고 보는 입장에 충분히 동의한다.
```

### 5.7 설명되지 않은 값을 사용하지 말라

값은 당연히 존재한다. 그렇지 않으면 컴파일되지 않거나 작동하지 않을 것이기 때문에 그 점은 명백 하다. 하지만 그 값이 실제로 무엇을 의미하는지 다른 개발자들이 명확히 이해하도록 하는 것은 잊어 버리기 쉽다.

#### 5.7.1 설명되지 않은 값은 혼란스러울 수 있다

설명이 없는 값은 다른 개발자들이 그 값이 왜 거기에 있고, 무슨 일을 하는지 이해하지 못하기 때문에 코드의 가독성을 떨어트린다.
개발자가 자신도 이해하지 못하는 코드를 수정하면 코드가 작동하지 않게 될 가능성이 커진다.

코드에 설명되지 않은 값이 있으면 혼란을 초래하고 이로 인해 버그가 발생할 수 있다.
그 값이 무엇을 의미하는지를 다른 개발자들에게 명확하게 해주는 것이 중요하다.

#### 5.7.2 해결책: 잘 명명된 상수를 사용하라

상수를 정의하고 상수 이름을 통해 값을 설명 한다.
코드에서 값을 직접 사용하는 대신 상수를 사용하면 상수 이름이 코드를 설명한다는 것을 의미한다.

#### 5.7.3 해결책: 잘 명명된 함수를 사용하라

코드의 가독성을 높이기 위해 함수를 사용할 수 있는 방법은 두 가지가 있다.

- 상수를 반환하는 공급자 함수 provider function
  - 개념적으로 상수를 사용하는 것과 거의 동일하다
- 변환을 수행하는 헬퍼 함수 helper function
  - 공급자 함수를 사용하는 것의 대안으로는 수량의 변환을 하위 문제로 만들어 이 기능을 전문적으로 수행하는 함수를 작성하는 것이다. 수량 변환 시 사용되는 계수가 있다는 사실은 함수를 호출하는 쪽에서 몰라도 되는 구현 세부 사항이다.

상수로 정의한 값이나 헬퍼 함수를 다른 개발자들이 재사용할 것인지 고려해볼 만한 가치가 있다. 
그럴 가능성이 있다면 별도의 유틸리티 클래스에 두는 것이 좋다.

### 5.8 익명 함수를 적절하게 사용하라

annoymous function은 이름이 없는 함수고, 코드 내의 필요한 지점에서 인라인으로 정의된다.
간단하고 자명한 것에 익명 함수를 쓰면 코드의 가독성을 높일 수 있다.
하지만 복잡하거나 자명하지 않은 것 혹은 재사용해야 하는 것에 사용하면 문제가 될 수 있다.

#### 5.8.1 익명 함수는 간단한 로직에 좋다

하나의 문장으로 충분히 표현 가능하고, 해결하려는 문제가 간단하다면
이해하기 쉽고 단순 명료하기에 쓰기 좋다.

코멘트를 하나 이상 가지고 있는 피드백을 가져온다고 하면 아래와 같이 표현할 수 있다.
``` java
return allFeedback.filter(feedback -> !feedback.getComment().isEmpty());
```

#### 5.8.2 익명 함수는 가독성이 떨어질 수 있다

익명 함수는 정의상 이름이 없기 때문에 익명 함수 코드를 읽는 사람에게 어떠한 것도 제공하지 않는다.
그것이 얼마나 간단한 것이든 간에 익명 함수의 내용이 자명하지 않다면 코드의 가독성은 떨어진다.

``` java
return ids.filter(id -> id != 0).filter(id -> countSetBits(id & 0x7FFF) % 2 == ((id & 0x8000) >> 15));
```

#### 5.8.3 해결책: 대신 명명 함수를 사용하라

ID가 유효하거나 유효하지 않은 이유를 높은 수준에서 이해하기 위해서는 비트 연산과 같은 하위 수준의 개념 때문에 어려움을 겪도록 해서는 안 된다.

아래와 같이 패리티 비트의 세부 사항에 대한 헬퍼 함수를 쓰면 가독성이 높아진다.
또 패리티 비트를 확인하는 논리를 재사용하기가 쉽다.

``` java
return ids.filter(id -> id != 0).filter(isParityBitCorrect);

private Boolean isParityBitCorrect(UInt16 id) {
...
}
```

익명 대신 명명을 사용하는 것의 단점은 더 많은 코드를 작성해야 한다는 것이다.
간단하고 자명한 논리는 익명 함수를 써도 일반적으로 괜찮지만, 복잡한 논리는 명명 함수를 쓰는 것이 이점이 더 많다.

#### 5.8.4 익명 함수가 길면 문제가 될 수 있다

함수형 스타일을 채택한다고 해서 반드시 인라인 익명 함수를 사용해야 하는 것은 아니다.

익명 함수가 두세줄 이상으로 늘어나기 시작할 때, 여러 개의 명명 함수로 분리하면 코드의 가독성이 좋아진다.

#### 5.8.5 해결책: 긴 익명 함수를 여러 개의 명명 함수로 나누라

한꺼번에 너무 많은 일을 하는 큰 함수를 분리하는 것은 코드의 가독성을 (그리고 재사용성 및 모듈화 까지도) 개선하기 위한 좋은 방법이다.
함수형 스타일의 코드를 작성할 때 이 점을 잊지 말아야 한다.
익명 함수가 길어지고 복잡해지면, 로직을 더 작은 단위의 명명 함수로 작성해야 한다.

### 5.9 프로그래밍 언어의 새로운 기능을 적절하게 사용하라

프로그래밍 언어의 새로운 기능으로 인해 코드의 가독성이 높아지거나 코드가 더 견고해지는 경우가 많이 있을 수 있다.
하지만 프로그래밍 언어의 새로운 기능이 정말로 그 일에 가장 적합한 도구인지 솔직하게 생각해봐야 한다.

#### 5.9.1 새 기능은 코드를 개선할 수 있다

무언가를 직접 만드는 대신 언어에서 제공하는 기능을 사용하면 코드가 최적화되어 효율적이고 버그가 없을 가능성이 커진다.
일반적으로 코드의 품질을 개선한다면 언어가 제공하는 기능을 사용하는 것이 좋다.

#### 5.9.2 불분명한 기능은 혼동을 일으킬 수 있다

해당 기능이 다른 개발자에게 얼마나 잘 알려져 있는지 고려할 필요가 있다.
일반적으로 코드 품질을 개선한다면 언어가 제공하는 기능을 사용하는 것이 바람직하다.
그러나 개선 사항이 적거나 다른 개발자가 그 기능에 익숙하지 않다면 차라리 사용하지 않는 것이 좋을 때도 있다.

```
의견)
보통 자기가 아직 모르는 문법이라면 배워서 알려고 하는 자세가 있다 보니 책에 나온 얘기에 대해서는 많이 동감하지 못하는 부분이 있다.
물론 우리나라에도 보수적인 개발자는 같은 기능이 동작한다면 낮은 버전의 문법을 써서 쉽게 만드는 게 좋다고 하는 부류도 있긴 했었지만,
거의 대부분 새로운 그리고 효율적인 문법이라면 배우고 실무에 써보려고 하는 부류가 더 많았기에,
나의 의견은 언어에서 제공하는 기능이라면 가급적 사용하고, 아직 그 기능을 모르는 개발자가 있다면 전파하는 식으로 하면 좋다는 생각이다.
```

#### 5.9.3 작업에 가장 적합한 도구를 사용하라

map에서 어떤 키에 대한 값을 찾아야 한다면 map.get(key)로 하지만 map.entrySet().stream().filter().map().findFirst()로 다소 과장되게도 구현이 가능하므로 문제 해결에 적합한 문법을 사용해야 한다.

새로운 기능은 큰 이점이 있지만 코드 작성에서와 동일하게 해당 기능이 단지 새로워서가 아니라 작업에 적합한 도구이기 때문에 사용한다는 점을 분명히 해야 한다.

### 요약

- If code is not readable and easy to understand then it can lead to problems such as the following:
  - Other engineers wasting time trying to decipher it
  - Misunderstandings that lead to bugs being introduced
  - Code being broken when other engineers need to modify it
- Making code more readable can sometimes lead to it becoming more verbose and taking up more lines. This is often a worthwhile trade-off
- Making code readable often requires being empathetic and imagining ways in which others might find something confusing
- Real-life scenarios are varied and usually present their own set of challenges. Writing readable code nearly always requires an element of applying common sense and using your judgement. 